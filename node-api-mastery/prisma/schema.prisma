generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// USER START

model User {
  id        String @id @default(uuid())
  email     String   @unique
  name      String?
  phone     String?   @unique
  
  createdAt DateTime @default(now())

  transactions Transaction[]
  recurringTransactions RecurringTransaction[]

  businesses Business[]
  appointments Appointment[]
  tasks Task[]
}

// USER END
// -------------------------------------------------------------------
// FINANCE START

model Transaction {
  id                String     @id @default(uuid())

  amount            Float    
  type              TransactionType
  category          Category
  description       String?
  date              DateTime      @default(now())

  createdAt         DateTime      @default(now())

  userId            String
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model RecurringTransaction {
  id           String          @id @default(uuid())
  amount       Float
  type         TransactionType // INCOME veya EXPENSE
  category     Category
  description  String?
  
  // Tekrarlama Kuralı
  frequency    FrequencyType          // "MONTHLY", "WEEKLY"
  dayOfMonth   Int?            // Ayın kaçıncı günü? (1-31)
  dayOfWeek    Int?            // Haftanın kaçıncı günü? (0-6)
  
  // Kontrol Alanları
  isActive     Boolean         @default(true)
  lastRunDate  DateTime?       // En son ne zaman otomatik işlem oluşturuldu?
  startDate    DateTime        @default(now())
  
  // İlişki
  userId       String
  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum Category {
  FOOD        // Yemek, Market, Restoran
  TRANSPORT   // Akaryakıt, Toplu Taşıma, Taksi
  RENT        // Kira Ödemeleri
  UTILITIES   // Faturalar (Elektrik, Su, İnternet)
  SALARY      // Maaş (Genelde INCOME tipi için)
  SHOPPING    // Giyim, Teknoloji, Kişisel harcamalar
  HEALTH      // Eczane, Hastane, Sigorta
  ENTERTAINMENT // Sinema, Oyun, Hobiler
  OTHER       
}

enum FrequencyType {
  MONTHLY
  WEEKLY
}

// FINANCE END
// -------------------------------------------------------------------
// BUSINESS START

model Business {
  id          String   @id @default(uuid())
  name        String
  category    String   // Örn: Berber, Klinik, Halı Saha
  description String?
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  
  services    Service[]
  appointments Appointment[]

  // Çalışma saatleri (Basit tutmak için JSON veya String tutabiliriz)
  workingHours String? // Örn: "09:00-18:00"
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Service {
  id          String   @id @default(uuid())
  name        String   // Örn: Saç Kesimi
  duration    Int      // Dakika cinsinden: 30, 60, 90
  price       Decimal  @db.Decimal(10, 2)
  description String?
  
  businessId  String
  business    Business @relation(fields: [businessId], references: [id], onDelete: Cascade)
  
  appointments Appointment[]
}

model Appointment {
  id          String            @id @default(uuid())
  startTime   DateTime          // Randevu başlangıç
  endTime     DateTime          // startTime + Service.duration
  
  userId      String?
  user        User?              @relation(fields: [userId], references: [id])

  guestName  String?
  guestPhone String?

  status      AppointmentStatus @default(PENDING)

  businessId  String
  business    Business          @relation(fields: [businessId], references: [id], onDelete: Cascade)
  
  serviceId   String
  service     Service           @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  createdAt   DateTime          @default(now())
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

// BUSINESS END
// -------------------------------------------------------------------
//TASK START

enum TaskStatus {
  TODO
  IN_PROGRESS
  COMPLETED
  ARCHIVED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskCategory {
  WORK
  PERSONAL
  FINANCE
  HEALTH
  OTHER
}

model Task {
  id          String       @id @default(uuid())
  title       String
  description String?
  status      TaskStatus   @default(TODO)
  priority    TaskPriority @default(MEDIUM)
  category    TaskCategory @default(OTHER)
  
  // Gelecek zamanlı görevler için bitiş tarihi
  dueDate     DateTime?
  
  // İlişkiler
  userId      String
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([userId])
  @@index([status])
}

//TASK END